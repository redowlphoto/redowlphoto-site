{{/* schema-work.html */}}
{{- $p := .Page -}}

{{- /* Find absolut billed-URL */ -}}
{{- $img := "" -}}
{{- with $p.Resources.GetMatch ($p.Params.cover.image) -}}
  {{- $img = .Permalink -}}
{{- else -}}
  {{- with $p.Params.cover.image -}}
    {{- if hasPrefix . "http" -}}
      {{- $img = . -}}
    {{- else -}}
      {{- $img = (print $p.Permalink .) -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{- /* Basisfelter */ -}}
{{- $abstract := ( $p.Summary | plainify | default $p.Params.caption ) -}}
{{- $iso      := $p.Date.Format "2006-01-02T15:04:05Z07:00" -}}
{{- $year     := $p.Date.Format "2006" -}}
{{- $lang     := ( $p.Site.LanguageCode | default "en" ) -}}
{{- $authorNm := ( default "RedOwlPhoto" $p.Site.Params.author.name ) -}}
{{- $authorURL:= ( default $p.Site.BaseURL $p.Site.Params.author.url ) -}}

{{- /* Article m. image + author.url */ -}}
{{- $article := dict
  "@context" "https://schema.org"
  "@type" "Article"
  "articleSection" "Works"
  "name" $p.Title
  "headline" $p.Title
  "abstract" $abstract
  "inLanguage" $lang
  "url" $p.Permalink
  "image" $img
  "author" (dict "@type" "Person" "name" $authorNm "url" $authorURL)
  "copyrightYear" $year
  "dateCreated" $iso
  "datePublished" $iso
  "dateModified" $iso
  "keywords" $p.Params.tags
  "mainEntityOfPage" true
-}}

{{- /* CreativeWork/ImageObject */ -}}
{{- $imageObj := dict
  "@context" "https://schema.org"
  "@type" (slice "CreativeWork" "ImageObject")
  "name" $p.Title
  "url" $p.Permalink
  "image" $img
  "caption" $p.Params.caption
  "contentLocation" (dict "@type" "Place" "name" $p.Params.location)
  "genre" (slice "Minimalist" "Seascape" "Fine Art")
  "datePublished" ($p.Date.Format "2006-01-02")
  "inLanguage" $lang
  "creator" (dict "@type" "Person" "name" "Allan Andersen" "url" $authorURL)
  "sameAs" (slice "https://www.instagram.com/redowlphoto/")
-}}

<script type="application/ld+json">{{ (slice $article $imageObj) | jsonify | safeHTML }}</script>
