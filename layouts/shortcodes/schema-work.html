{{- $p := .Page -}}

{{/* === Find det bedste billede === */}}
{{- $img := "" -}}
{{- with $p.Params.cover }}{{ with .image }}{{ $img = . | absURL }}{{ end }}{{ end -}}
{{- if not $img }}{{ with $p.Params.image }}{{ $img = . | absURL }}{{ end }}{{ end -}}
{{- if not $img }}
  {{- with $p.Resources.GetMatch "*" }}{{ $img = .Permalink }}{{ end -}}
{{- end -}}
{{- if not $img }}
  {{- with index $p.Params.images 0 }}{{ $img = . | absURL }}{{ end -}}
{{- end -}}

{{/* === Byg JSON-LD data uden dobbelte citationstegn === */}}
{{- $data := dict
  "@context" "https://schema.org"
  "@type" (slice "CreativeWork" "ImageObject")
  "name" $p.Title
  "creator" (dict "@type" "Person" "name" "Allan Andersen")
  "url" $p.Permalink
  "image" $img
  "genre" (slice "Minimalist" "Seascape" "Fine Art")
  "datePublished" ($p.Date.Format "2006-01-02")
  "inLanguage" "en"
-}}

{{- with $p.Params.caption -}}
  {{- $data = merge $data (dict "caption" .) -}}
{{- end -}}

{{- with $p.Params.location -}}
  {{- $data = merge $data (dict "contentLocation" (dict "@type" "Place" "name" .)) -}}
{{- end -}}

<script type="application/ld+json">{{ $data | jsonify }}</script>
